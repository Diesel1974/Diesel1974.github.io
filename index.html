<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S&P 500 Trip-Wire Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-6">S&P 500 Trip-Wire Dashboard</h1>
    <p class="text-center text-gray-600 mb-8">Monitor key risk indicators for the S&P 500. Updated live.</p>

    <!-- Summary Gauge -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h2 class="text-xl font-semibold mb-4">Overall Risk Level</h2>
      <div id="risk-gauge" class="text-center">
        <span id="risk-level" class="text-2xl font-bold">Calculating...</span>
        <p id="risk-score" class="text-gray-600">Total Score: 0/20</p>
      </div>
      <div class="text-center mt-4">
        <button onclick="fetchData()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
          Refresh Data
        </button>
      </div>
    </div>

    <!-- Trip-Wire Table -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold mb-4">Trip-Wire Indicators</h2>
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-3">Indicator</th>
            <th class="p-3">Current Value</th>
            <th class="p-3">Threshold</th>
            <th class="p-3">Status</th>
            <th class="p-3">Severity Score</th>
          </tr>
        </thead>
        <tbody id="trip-wire-table"></tbody>
      </table>
    </div>

    <!-- Notes -->
    <div class="mt-8 text-gray-600 text-sm">
      <h3 class="text-lg font-semibold">Notes</h3>
      <p>This dashboard uses live data for VIX (via AlphaVantage) and Yield Curve (via FRED).</p>
    </div>
  </div>

<script>
const indicators = [
  { name: "Yield-Curve (2s/10s)", current: "-30 bps", threshold: "< -50 bps", value: -30, thresholdValue: -50, check: v => v < -50, severity: 0 },
  { name: "Leading Economic Index (LEI)", current: "-0.5% MoM", threshold: ">1% drop", value: -0.5, thresholdValue: -1, check: v => v < -1, severity: 0 },
  { name: "Earnings Guidance", current: "40% negative", threshold: ">50% negative", value: 40, thresholdValue: 50, check: v => v > 50, severity: 0 },
  { name: "Credit Spreads (IG)", current: "120 bps", threshold: ">150 bps", value: 120, thresholdValue: 150, check: v => v > 150, severity: 0 },
  { name: "VIX", current: "18", threshold: ">25 for 3 days", value: 18, thresholdValue: 25, check: v => v > 25, severity: 0 },
  { name: "Market Breadth", current: "1.2:1 highs/lows", threshold: ">2:1 lows/highs", value: 1.2, thresholdValue: 2, check: v => v > 2, severity: 0 },
  { name: "Fund Flows", current: "$2B inflows", threshold: ">$10B outflows", value: 2, thresholdValue: -10, check: v => v < -10, severity: 0 },
  { name: "Fed Policy", current: "Neutral", threshold: "Hawkish", value: 0, thresholdValue: 1, check: v => v >= 1, severity: 0 },
  { name: "Core CPI", current: "2.8%", threshold: ">3%", value: 2.8, thresholdValue: 3, check: v => v > 3, severity: 0 },
  { name: "Trade Escalations", current: "Current tariffs", threshold: "New tariffs", value: 0, thresholdValue: 1, check: v => v >= 1, severity: 0 },
];

async function fetchData() {
  const alphaKey = "24C19NQFT0CEY88B";  // Your Alpha Vantage key
  const fredKey = "d49ebc25ed38d212a6a4b8af90abcedf"; // Your FRED key

  try {
    // Fetch VIX
    const vixResponse = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=VIXY&apikey=${alphaKey}`);
    const vixData = await vixResponse.json();
    const vixPrice = parseFloat(vixData["Global Quote"]["05. price"]);

    if (!isNaN(vixPrice)) {
      const vixIndicator = indicators.find(ind => ind.name === "VIX");
      if (vixIndicator) {
        vixIndicator.current = `${vixPrice.toFixed(2)}`;
        vixIndicator.value = vixPrice;
      }
    }

    // Fetch 10Y Treasury
    const tenYearResponse = await fetch(`https://api.stlouisfed.org/fred/series/observations?series_id=GS10&api_key=${fredKey}&file_type=json&sort_order=desc`);
    const tenYearData = await tenYearResponse.json();
    const tenYearRate = parseFloat(tenYearData.observations[0].value);

    // Fetch 2Y Treasury
    const twoYearResponse = await fetch(`https://api.stlouisfed.org/fred/series/observations?series_id=GS2&api_key=${fredKey}&file_type=json&sort_order=desc`);
    const twoYearData = await twoYearResponse.json();
    const twoYearRate = parseFloat(twoYearData.observations[0].value);

    if (!isNaN(tenYearRate) && !isNaN(twoYearRate)) {
      const yieldCurveValue = tenYearRate - twoYearRate;
      const yieldCurveIndicator = indicators.find(ind => ind.name.includes("Yield-Curve"));
      if (yieldCurveIndicator) {
        yieldCurveIndicator.current = `${yieldCurveValue.toFixed(2)} bps`;
        yieldCurveIndicator.value = yieldCurveValue;
      }
    }

    updateDashboard();

  } catch (error) {
    console.error("Error fetching data:", error);
    alert("Failed to fetch live data. Try again later.");
  }
}

function updateDashboard() {
  const tableBody = document.getElementById("trip-wire-table");
  tableBody.innerHTML = "";
  let totalScore = 0;

  indicators.forEach(indicator => {
    const isTriggered = indicator.check(indicator.value);
    indicator.severity = isTriggered ? (indicator.value > indicator.thresholdValue * 1.5 ? 2 : 1) : 0;
    totalScore += indicator.severity;

    const statusText = indicator.severity === 0 ? "Safe" : indicator.severity === 1 ? "Caution" : "Alert";
    const statusClasses = indicator.severity === 0 ? "bg-green-200 text-green-800" :
                           indicator.severity === 1 ? "bg-yellow-200 text-yellow-800" :
                           "bg-red-200 text-red-800";

    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="p-3">${indicator.name}</td>
      <td class="p-3">${indicator.current}</td>
      <td class="p-3">${indicator.threshold}</td>
      <td class="p-3"><span class="px-2 py-1 rounded ${statusClasses}">${statusText}</span></td>
      <td class="p-3">${indicator.severity}</td>
    `;
    tableBody.appendChild(row);
  });

  const riskLevel = totalScore <= 5 ? "Mild Caution" :
                    totalScore <= 10 ? "Meaningful Caution" : "Red Alert";

  const riskColor = totalScore <= 5 ? "text-green-600" :
                    totalScore <= 10 ? "text-yellow-600" : "text-red-600";

  document.getElementById("risk-level").textContent = riskLevel;
  document.getElementById("risk-level").className = `text-2xl font-bold ${riskColor}`;
  document.getElementById("risk-score").textContent = `Total Score: ${totalScore}/20`;
}

fetchData();
</script>
</body>
</html>
